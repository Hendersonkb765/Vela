import{j as e,r as c,W as ae}from"./app-CtPP1DNG.js";import{P as E}from"./PrimaryButton-CgHh9L6v.js";import{D as ie}from"./DateInput-CaQdbuvS.js";import{I as l}from"./InputLabel-DpcK_Rcy.js";import{d as re,e as P,f as se,g as ne}from"./index-DZYEFDQs.js";import{T as N}from"./TextInput-BO1oMSBD.js";import{S as q}from"./SecondaryButton-CJd_1Wwq.js";import{P as L}from"./PrimaryIconButton-E5beE6gg.js";import"./iconBase-qlBafJIs.js";function oe({label:A="Melhorar com IA",loading:n=!0,loadingLabel:x="Melhorando...",...i}){return e.jsxs("p",{...i,className:`transition-colors hover:text-primary-100 flex gap-1 items-center text-primary cursor-pointer text-sm font-medium ${n&&"bg-clip-text text-transparent bg-[length:200%_200%] bg-gradient-to-r from-blue-500 via-teal-400 to-purple-700 animate-gradient-move"}`,children:[" ",e.jsx(re,{strokeWidth:"0.7",className:` ${n&&"hidden"}`}),n?x:A]})}const S=150;function ye({onSubmit:A}){const[n,x]=c.useState(1),[i,d]=c.useState({}),[D,p]=c.useState(""),[O,T]=c.useState(!1),[y,I]=c.useState(""),[R,H]=c.useState(!1),[_,f]=c.useState(!1),[G,U]=c.useState(!1),W="1900-01-01",$=new Date(new Date().getFullYear(),11,31).toISOString().split("T")[0],{data:r,setData:m,processing:B,post:X,progress:ce}=ae({activityTitle:"",activityDescription:"",activityAudience:"",activityDate:"",activityHourStart:"06:00",activityHourEnd:"07:00",activityThumbnail:"",activityImages:[]}),Z=async()=>{T(!0);try{const t=await fetch("/reformular",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({description:r.activityDescription})});if(t.ok){const a=await t.json();console.log(a),m("activityDescription",a.message)}else console.error("Erro ao reformular descrição.")}catch(t){console.error("Erro na requisição:",t)}T(!1)},v=t=>{const{name:a,value:s}=t.target;m({...r,[a]:s})},z=()=>{const t={};return r.activityTitle||(t.activityTitle="O título é obrigatório."),r.activityDescription||(t.activityDescription="A descrição é obrigatória."),r.activityAudience||(t.activityAudience="A audiência é obrigatória."),d(t),Object.keys(t).length===0},J=()=>{const t={};return r.activityDate||(t.activityDate="A data é obrigatória."),r.activityHourStart||(t.activityHourStart="A hora de início é obrigatória."),r.activityHourEnd||(t.activityHourEnd="A hora de fim é obrigatória."),r.activityHourStart>=r.activityHourEnd&&(t.activityHourEnd="A hora de fim deve ser após a hora de início."),r.activityHourStart===r.activityHourEnd&&(t.activityHourEnd="A hora de fim deve ser diferente da hora de início."),d(t),Object.keys(t).length===0},K=t=>{var o;const a=(o=t.target.files)==null?void 0:o[0];if(!a)return;const s=new FileReader;s.addEventListener("load",()=>{var h;const u=new Image,g=((h=s.result)==null?void 0:h.toString())||"";u.src=g,u.addEventListener("load",b=>{const{naturalHeight:j,naturalWidth:w}=b.currentTarget;if(w<S||j<S){d(k=>({...k,activityThumbnail:"Imagem muito pequena (tamanho mínimo: 150x150)"})),p("");return}p(g),m("activityThumbnail",a)})}),s.readAsDataURL(a)},M=t=>{const a=t.target.files;if(!a||a.length===0)return;const s=Array.from(a),o=[],u=[];s.forEach(g=>{const h=new FileReader;h.addEventListener("load",()=>{var w;const b=new Image,j=((w=h.result)==null?void 0:w.toString())||"";b.src=j,b.addEventListener("load",k=>{const{naturalHeight:V,naturalWidth:ee}=k.currentTarget;ee<S||V<S?u.push(`Imagem '${g.name}' muito pequena (tamanho mínimo: 150x150)`):o.push(j),o.length+u.length===s.length&&(u.length>0&&d(te=>({...te,activityThumbnail:u.join(", ")})),I(o),m("activityImages",s))})}),h.readAsDataURL(g)})},Q=t=>{I(a=>a.filter((s,o)=>o!==t)),m("activityImages",a=>a.filter((s,o)=>o!==t))},C=()=>{(n===1&&z()||n===2&&J())&&x(n+1)},F=()=>{x(n-1)},Y=async t=>{if(t.preventDefault(),r.activityThumbnail){f(!0);try{await X(route("activity.store"),{data:r,onFinish:()=>{p(""),f(!1)},onSuccess:()=>{H(!0),setTimeout(()=>{H(!1)},5e3),window.location.reload()},onError:a=>{if(a.response){const s=a.response.data;console.error("Erro do servidor:",s),d(s),U(!0)}else console.error("Erro desconhecido:",a);f(!1)}})}catch(a){console.error("Erro ao enviar o formulário:",a),f(!1)}}else d({activityThumbnail:"A imagem é obrigatória."})};return e.jsxs("form",{onSubmit:Y,children:[n===1&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(l,{children:"Título da Atividade"}),e.jsx(N,{name:"activityTitle",value:r.activityTitle,onChange:v,required:!0,className:"mt-2 sm:mt-1 w-full sm:w-auto",placeholder:"Dê um título especial para sua atividade"}),i.activityTitle&&e.jsx("p",{className:"text-body text-sm text-red-500",children:i.activityTitle})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(l,{children:"Descrição"}),e.jsx(oe,{onClick:Z,loading:O})]}),e.jsx("textarea",{name:"activityDescription",value:r.activityDescription,onChange:v,className:"mt-2 sm:mt-1 block w-full sm:w-auto h-20 sm:min-w-96 rounded-md text-sm border-2 border-neutralcolors text-neutralcolors-600 dark:border-slate-500 dark:bg-gray-900 dark:text-neutral-400",required:!0,placeholder:"Descreva a atividade, não esqueça de citar os principais pontos como: objetivo, desenvolvimento da atividade e público alvo."}),i.activityDescription&&e.jsx("p",{className:"text-red-500 text-body text-sm",children:i.activityDescription})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(l,{children:"Audiencia"}),e.jsx(N,{type:"number",name:"activityAudience",value:r.activityAudience,onChange:v,required:!0,className:"mt-2 sm:mt-1 w-full sm:w-auto",placeholder:"Quantas pessoas participaram (beneficiários e voluntários)"}),i.activityAudience&&e.jsx("p",{className:"text-red-500 text-body text-sm",children:i.activityAudience})]}),e.jsx(E,{center:!0,onClick:C,className:"w-32 sm:w-40 !ml-auto !h-12 ",children:"Próximo"})]}),n===2&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(l,{children:"Data da Atividade"}),e.jsx(ie,{id:"activityDate",name:"activityDate",value:r.activityDate,onChange:t=>m("activityDate",t.target.value),minDate:W,maxDate:$,className:"mt-2 sm:mt-1 w-full sm:w-auto",required:!0}),i.activityDate&&e.jsx("p",{className:"text-red-500 text-body text-sm",children:i.activityDate})]}),e.jsxs("div",{className:"flex flex-row justify-between sm:flex-col ",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(l,{children:"Hora de Início"}),e.jsx(N,{type:"time",name:"activityHourStart",value:r.activityHourStart,onChange:v,className:"mt-2 w-36 dark:[color-scheme:dark]",required:!0}),i.activityHourStart&&e.jsx("p",{className:"text-red-500 text-body text-sm",children:i.activityHourStart})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx(l,{children:"Hora de Fim"}),e.jsx(N,{type:"time",name:"activityHourEnd",value:r.activityHourEnd,className:"mt-2 w-36 dark:[color-scheme:dark]",onChange:v,required:!0}),i.activityHourEnd&&e.jsx("p",{className:"text-red-500 text-body text-sm",children:i.activityHourEnd})]})]}),e.jsxs("div",{className:"flex justify-between mt-12",children:[e.jsx(q,{center:!0,onClick:F,className:"!h-12 w-32 sm:w-40",children:"Anterior"}),e.jsx(E,{center:!0,onClick:C,className:"!h-12 w-32 sm:w-40",children:"Próximo"})]})]}),n===3&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(l,{children:"Foto para Thumbnail"}),e.jsx("span",{className:"sr-only ",children:"Escolha uma foto para Thumbnail"}),e.jsx("input",{id:"thumbnail_input",type:"file",accept:"image/*",onChange:K,className:"mt-2 h-10 sm:mt-1 w-full sm:w-auto block dark:text-gray-200 file:h-10 file:border-none file:rounded-lg file:mr-4 dark:file:bg-slate-900 dark:file:hover:bg-slate-900/70 dark:file:text-gray-200 file:cursor-pointer"}),i.activityThumbnail&&e.jsx("p",{className:"text-red-500 text-body text-sm",children:i.activityThumbnail})]}),D&&e.jsxs("div",{className:"mt-4 relative flex items-end hover:items-center  justify-center w-fit group cursor-pointer transition-all",children:[e.jsx("img",{src:D,alt:"Preview",className:"h-24 w-24 object-cover rounded-lg  group-hover:brightness-50"}),e.jsx(L,{onClick:()=>{p(""),m({activityThumbnail:null})},className:"!rounded-full absolute text-white/80 group-hover:!text-danger !bg-transparent group-hover:block flex-col !items-center",children:e.jsx(P,{className:"w-6 h-6 group-hover:w-8 group-hover:h-8"})})]}),e.jsxs("div",{className:"my-4",children:[e.jsx(l,{children:"Fotos da Atividade"}),e.jsx("span",{className:"sr-only ",children:"Escolha fotos para galeria"}),e.jsx("input",{id:"thumbnail_input",type:"file",accept:"image/*",onChange:M,multiple:!0,className:"mt-2 h-10 sm:mt-1 w-full sm:w-auto block dark:text-gray-200 file:h-10 file:border-none file:rounded-lg file:mr-4 dark:file:bg-slate-900 dark:file:hover:bg-slate-900/70 dark:file:text-gray-200 file:cursor-pointer"}),i.activityThumbnail&&e.jsx("p",{className:"text-red-500 text-body text-sm",children:i.activityThumbnail})]}),y.length>0&&e.jsxs("div",{className:"mt-4 max-w-96 flex flex-wrap gap-4",children:[y.slice(0,3).map((t,a)=>e.jsxs("div",{className:"relative flex items-end flex-wrap hover:items-center justify-center w-fit group cursor-pointer transition-all",children:[e.jsx("img",{src:t,alt:`Preview ${a}`,className:"h-24 w-24 object-cover rounded-lg group-hover:brightness-50"}),e.jsx(L,{onClick:()=>Q(a),className:"!rounded-full absolute text-white/80 group-hover:!text-danger !bg-transparent group-hover:block flex-col !items-center",children:e.jsx(P,{className:"w-6 h-6 group-hover:w-8 group-hover:h-8"})})]},a)),y.length>2&&e.jsxs("div",{className:"flex items-center justify-center text-neutral-700 dark:text-white mt-2",children:["+",y.length-3]})]}),e.jsxs("div",{className:"flex justify-between mt-12",children:[e.jsx(q,{center:!0,onClick:F,className:"!h-12 w-32 sm:w-40",children:"Anterior"}),e.jsx(E,{center:!0,type:"submit",disabled:B,className:"!h-12 w-32 sm:w-40",children:"Enviar"})]})]}),_&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"absolute flex justify-center items-center top-0 right-0 z-10 w-full h-full bg-gray-800 bg-opacity-50 dark:bg-opacity-70 ",children:e.jsxs("div",{className:"flex flex-col gap-2 items-center justify-center h-screen",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-primary border-t-transparent"}),e.jsx("p",{className:"text-primary font-medium ",children:"Carregando..."})]})})}),Object.keys(i).length>0&&G&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-gray-800 bg-opacity-50",children:e.jsxs("div",{className:"bg-white p-6 rounded shadow-lg dark:bg-slate-800 dark:text-white",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(se,{className:"text-6xl text-danger"}),e.jsx("h2",{className:"text-3xl font-semibold",children:"Erro"})]}),e.jsx("p",{children:"Erro ao enviar atividade:"}),e.jsx("ul",{className:"mt-2 list-disc list-inside",children:Object.entries(i).map(([t,a])=>e.jsxs("li",{children:[t,": ",Array.isArray(a)?a.join(", "):a]},t))}),e.jsx("button",{onClick:()=>d({}),className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded",children:"Fechar"})]})}),R&&e.jsx("div",{className:"animate-enter fixed inset-0 flex items-center justify-center bg-gray-800 bg-opacity-50",children:e.jsx("div",{className:"bg-white p-6 rounded shadow-lg dark:bg-slate-800 dark:text-white",children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(ne,{className:"text-6xl text-success"}),e.jsx("h2",{className:"text-3xl font-semibold",children:"Sucesso!"})]})})})]})}export{ye as default};
